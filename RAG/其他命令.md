## 因果追踪实验

```bash
python RAG/causal_trace_experiment.py \
--model_name llama2_chat_7B \
--dataset_path RAG/data/NQ/test_noise_test_noise4.jsonl \
--use_chat_template \
--probes_path RAG/probes/llama2_chat_7B_nq_user/llama2_chat_7B_nq_seed_2025_top_1024_folds_3_probes.pkl \
--val_accs_path RAG/probes/llama2_chat_7B_nq_user/llama2_chat_7B_nq_seed_2025_top_1024_folds_3_val_accs.npy \
--tuning_headwise_path RAG/features/llama2_chat_7B_nq_user/llama2_chat_7B_nq_head_wise.npy \
--tuning_labels_path RAG/features/llama2_chat_7B_nq_user/llama2_chat_7B_nq_labels.npy \
--alpha 5.0 --max_new_tokens 256 --output_csv RAG/results/llama-2-chat-7b-nq-user/causal_layer_trace_pf0.csv
```

### 前 k 层干预超参数搜索实验 (Based on Causal Trace)

- 示例命令：
```bash
python RAG/nq_layer_hparam_search.py \
--model_name llama2_chat_7B \
--dataset_path RAG/data/TriviaQA/test_noise_test_noise4.jsonl \
--use_chat_template \
--probes_path RAG/probes/llama2_chat_7B_nq_user/llama2_chat_7B_nq_seed_2025_top_1024_folds_3_probes.pkl \
--val_accs_path RAG/probes/llama2_chat_7B_nq_user/llama2_chat_7B_nq_seed_2025_top_1024_folds_3_val_accs.npy \
--tuning_headwise_path RAG/features/llama2_chat_7B_nq_user/llama2_chat_7B_nq_head_wise.npy \
--tuning_labels_path RAG/features/llama2_chat_7B_nq_user/llama2_chat_7B_nq_labels.npy \
--sample_size 100 \
--probe_factor_modes false \
--results_root RAG/results/llama-2-chat-7b-triviaqa-user/top-layers-intervention \
--summary_csv top_layer_intervention_results.csv \
--alphas 5 \
--max_new_tokens 256
```

### 细粒度超参数搜索实验
- 示例命令：
```bash
python RAG/nq_fine_grained_hparam_search.py \
--model_name llama2_chat_7B \
--dataset_path RAG/data/TriviaQA/test_noise_test_noise4.jsonl \
--use_chat_template \
--probes_path RAG/probes/llama2_chat_7B_nq_user/llama2_chat_7B_nq_seed_2025_top_1024_folds_3_probes.pkl \
--val_accs_path RAG/probes/llama2_chat_7B_nq_user/llama2_chat_7B_nq_seed_2025_top_1024_folds_3_val_accs.npy \
--tuning_headwise_path RAG/features/llama2_chat_7B_nq_user/llama2_chat_7B_nq_head_wise.npy \
--tuning_labels_path RAG/features/llama2_chat_7B_nq_user/llama2_chat_7B_nq_labels.npy \
--causal_trace_path RAG/results/llama-2-chat-7b-nq-user/causal_layer_trace_pf0.csv \
--head_scores_path RAG/probes/llama2_chat_7B_nq_user/accs_csv.csv \
--sample_size 100 \
--top_k_layers 8 \
--thresholds 0.75,0.7,0.65,0.6,0.55,0.48 \
--results_root RAG/results/llama-2-chat-7b-triviaqa-user/nq_fine_grained \
--summary_csv triviaqa_noise4_result_top_8_layers_score.csv \
--alphas 5 \
--max_new_tokens 256
```

## CoN
- 示例命令：
```bash
python RAG/con_rag.py --model_name llama2_chat_7B --dataset_path RAG/data/PopQA/test_noise_test_noise4.jsonl --use_chat_template --max_docs 5 --sample_size 300 --max_new_tokens 256 --results_root RAG/results/llama-2-chat-7b-popqa-user/CON_300
```

## naive LLM
- 示例命令：
```bash
python RAG/naive_llm.py \
--model_name llama2_chat_7B \
--dataset_path RAG/data/PopQA/test_noise_test_noise4.jsonl \
--use_chat_template \
--sample_size 300 \
--max_new_tokens 256 \
--results_root RAG/results/llama-2-chat-7b-popqa-user/naive-llm
```

## 推理时间
```bash
python RAG/inference_time_experiment.py \
--model_name llama2_chat_7B \
--dataset_path RAG/data/PopQA/test_noise_test_noise4.jsonl \
--probes_path RAG/probes/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_seed_2025_top_1024_folds_3_probes.pkl \
--val_accs_path RAG/probes/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_seed_2025_top_1024_folds_3_val_accs.npy \
--tuning_headwise_path RAG/features/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_head_wise.npy \
--tuning_labels_path RAG/features/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_labels.npy \
--scores_csv RAG/probes/llama2_chat_7B_popqa_user_noise/accs_csv.csv
--sample_size 300 \
--max_new_tokens 256
```