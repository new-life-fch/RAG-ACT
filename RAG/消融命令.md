### 2. 运行示例
以下是针对您提到的五种消融实验的运行命令示例。假设您使用的是 Llama-2-7b-chat 模型，并且已经完成了激活采集和探针训练。

 A. 探针系数方向 (Probe Coefficients)
验证使用探针权重作为方向是否优于 CoM 方向。

```bash
python RAG/run_ablation.py \
--model_name llama2_chat_7B \
--dataset_path RAG/data/PopQA/test_noise_test_noise4.jsonl \
--ablation_mode probe_coef \
--alpha 7.0 --top_k 35 --use_chat_template \
--probes_path RAG/probes/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_seed_2025_top_1024_folds_3_probes.pkl \
--val_accs_path RAG/probes/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_seed_2025_top_1024_folds_3_val_accs.npy \
--tuning_headwise_path RAG/features/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_head_wise.npy \
--tuning_labels_path RAG/features/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_labels.npy \
--scores_csv RAG/probes/llama2_chat_7B_popqa_user_noise/accs_csv.csv
``` 
B. 反向干预 (Reverse Intervention)
验证将方向反转（ alpha 变为负向效果）是否会导致性能大幅下降。

```bash
python RAG/run_ablation.py \
--model_name llama2_chat_7B \
--dataset_path RAG/data/PopQA/test_noise_test_noise4.jsonl \
--ablation_mode reverse_com \
--alpha 7.0 --top_k 35 --use_chat_template \
--probes_path RAG/probes/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_seed_2025_top_1024_folds_3_probes.pkl \
--val_accs_path RAG/probes/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_seed_2025_top_1024_folds_3_val_accs.npy \
--tuning_headwise_path RAG/features/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_head_wise.npy \
--tuning_labels_path RAG/features/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_labels.npy \
--scores_csv RAG/probes/llama2_chat_7B_popqa_user_noise/accs_csv.csv
``` 
C. 随机方向 (Random Direction)
验证干预方向是否必须具有生物学/数学意义（CoM 或探针）。

```bash
python RAG/run_ablation.py \
--model_name llama2_chat_7B \
--dataset_path RAG/data/PopQA/test_noise_test_noise4.jsonl \
--ablation_mode random_dir \
--alpha 7.0 --top_k 35 --use_chat_template \
--probes_path RAG/probes/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_seed_2025_top_1024_folds_3_probes.pkl \
--val_accs_path RAG/probes/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_seed_2025_top_1024_folds_3_val_accs.npy \
--tuning_headwise_path RAG/features/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_head_wise.npy \
--tuning_labels_path RAG/features/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_labels.npy \
--scores_csv RAG/probes/llama2_chat_7B_popqa_user_noise/accs_csv.csv
``` 
D. 随机选择头 (Randomly Select Heads)
验证 Top-k 头的选择策略是否比随机选头更有效。

```bash
python RAG/run_ablation.py \
--model_name llama2_chat_7B \
--dataset_path RAG/data/PopQA/test_noise_test_noise4.jsonl \
--ablation_mode random_heads \
--alpha 7.0 --top_k 35 --use_chat_template \
--probes_path RAG/probes/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_seed_2025_top_1024_folds_3_probes.pkl \
--val_accs_path RAG/probes/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_seed_2025_top_1024_folds_3_val_accs.npy \
--tuning_headwise_path RAG/features/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_head_wise.npy \
--tuning_labels_path RAG/features/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_labels.npy \
--scores_csv RAG/probes/llama2_chat_7B_popqa_user_noise/accs_csv.csv
``` 
E. 底部头干预 (Bottom-k Heads Intervention)
验证干预那些“无法区分噪声”的头是否不会带来提升。

```bash
python RAG/run_ablation.py \
--model_name llama2_chat_7B \
--dataset_path RAG/data/PopQA/test_noise_test_noise4.jsonl \
--ablation_mode bottom_heads \
--alpha 7.0 --top_k 35 --use_chat_template \
--probes_path RAG/probes/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_seed_2025_top_1024_folds_3_probes.pkl \
--val_accs_path RAG/probes/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_seed_2025_top_1024_folds_3_val_accs.npy \
--tuning_headwise_path RAG/features/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_head_wise.npy \
--tuning_labels_path RAG/features/llama2_chat_7B_popqa_user_noise/llama2_chat_7B_popqa_labels.npy \
--scores_csv RAG/probes/llama2_chat_7B_popqa_user_noise/accs_csv.csv
```
### 说明
- probe_coef : 使用探针训练得到的系数作为干预方向。
- reverse_com : 将 CoM 方向取反，预期结果会变差。
- random_dir : 在 Top-k 头上应用随机高斯方向。
- random_heads : 随机选择 35 个头（Llama-2 7B 默认数量）进行 CoM 干预。
- bottom_heads : 选择探针验证准确率最低的 35 个头进行 CoM 干预。
您可以直接运行这些命令来获取对应的消融数据，结果将自动保存在 RAG/results/ablation/ 目录下。我已经为您写好了代码。我已经为您编写并保存了 RAG/run_ablation.py 脚本。